/*! gifscratcher.js v0.2  (c) 2014 Linus Lundahl | MIT license */
!function(e){"use strict";var t=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),i=function(e,t){this.init(e,t)};i.prototype={init:function(t,i){var s=this;return s.settings=e.extend({sprite:"",frames:0,interaction:"hover",auto:!0,cursor:!0,speed:5},i),s.$el=e(t),s.$image=s.$el.find("img"),s.elSize={w:0,h:0},s.elPos=s.$el.offset(),s.oldFrame=0,s.iAuto=0,s.userAction=!1,s.stopOnAction=!1,s.cursorInteraction=!0,s.$image.on("load",function(){s.elSize={w:s.$el.width(),h:s.$el.height()}}),s.settings.sprite&&(s.$el.addClass("gifscratcher"),s.$image.addClass("gs-img"),s.preload(function(){if(s.resize(),e(window).resize(),s.addCursor(),s.settings.auto&&(s.stopOnAction=!0,s.$el.addClass("gs-auto"),s.auto()),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))s.cursorInteraction=!1,s.$el.addClass("gs-touch"),s.touchInteraction();else{switch(s.settings.interaction){case"hover":s.$el.addClass("gs-hover"),s.hoverInteraction();break;case"drag":s.$el.addClass("gs-drag"),s.dragInteraction()}s.hover()}})),this},addCursor:function(){var t=this;return t.settings.cursor&&(t.$el.addClass("has-gs-cursor"),t.$cursor=e("<div></div>").addClass("gs-cursor").appendTo(t.$el)),this},preload:function(t){var i=this,s=new Image;return s.src=i.settings.sprite,s.onload=function(){i.$image.attr({src:i.settings.sprite}),e.isFunction(t)&&t()},this},touchInteraction:function(){var t=this;return t.$el.on("touchstart touchend",function(e){t.userAction="touchstart"===e.type?!0:!1,t.$el.toggleClass("active")}),e(window).on("touchmove",function(e){var i=e.originalEvent;t.userAction&&(i.preventDefault(),t.play(i.targetTouches[0].pageX-t.elPos.left))}),this},hoverInteraction:function(){var e=this;return e.$el.on("mousemove",function(t){e.play(t.pageX-e.elPos.left)}),this},dragInteraction:function(){var e=this,t=!1;return document.ondragstart=function(){return!1},e.$cursor.on("mousedown mouseup",function(e){e.preventDefault(),t=t||"mousedown"!==e.type?!1:!0}),e.$el.on("mousemove",function(i){i.preventDefault(),t&&e.play(i.clientX-e.elPos.left)}),this},auto:function(){var e,i=this,s=0;return e=function(){t(e),i.stopOnAction&&!i.userAction&&s===i.settings.speed&&(i.switchFrame(i.iAuto),i.iAuto=i.iAuto>=i.settings.frames-1?0:i.iAuto+1),s=s===i.settings.speed?0:s+1},e(),this},hover:function(){var t=this;return e("body").on("mousemove",function(e){e.pageX>=t.elPos.left&&e.pageX<=t.elPos.left+t.elSize.w&&e.pageY>=t.elPos.top&&e.pageY<=t.elPos.top+t.elSize.h?(t.$cursor&&t.cursorInteraction&&t.$cursor.css({left:e.pageX-t.elPos.left,top:e.pageY-t.elPos.top}),t.userAction||(t.$el.addClass("active"),t.userAction=!0)):(t.$cursor&&t.$cursor.removeAttr("style"),t.userAction&&(t.$el.removeClass("active"),t.userAction=!1,t.iAuto=t.oldFrame))}),this},resize:function(){var t=this;return e(window).on("resize",function(){t.$image.is(":visible")&&(t.elSize={w:t.$el.width(),h:t.$el.height()},t.elPos=t.$el.offset(),t.play(0),t.$image.css({width:t.settings.frames*t.elSize.w+"px"}))}),this},play:function(e){var t=this;return t.switchFrame(Math.floor(e/(Math.round(t.elSize.w/t.settings.frames*100)/100))),this},switchFrame:function(e){var t=this;return e!==t.oldFrame&&e<t.settings.frames&&t.$image.css({"margin-left":"-"+e*t.elSize.w+"px"}),t.oldFrame=e,this}},e.fn.gifscratcher=function(t){var s;return(s=this.data("gifscratcher"))?t===!0?s:("string"===e.type(t)&&s[t](),this):this.each(function(){return e(this).data("gifscratcher",new i(this,t))})}}(jQuery);